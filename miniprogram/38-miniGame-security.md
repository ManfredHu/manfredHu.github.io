# å¾®ä¿¡å°æ¸¸æˆä¹‹å•æœºæ¸¸æˆçš„å®‰å…¨

![å¾®ä¿¡å°æ¸¸æˆ](../images/miniGame.jpeg)

é¦–å…ˆèŠä¸€ä¸‹ï¼Œå¾®ä¿¡å°ç¨‹åºï¼Œæƒ³çœ‹å®‰å…¨ç®—æ³•ä¹‹ç±»çš„è¯·ç›´æ¥è·³åˆ°[è¿™é‡Œ](#å•æœºæ¸¸æˆå®‰å…¨æ€ä¹ˆåš)

# å°ç¨‹åºå®‰å…¨é—®é¢˜çš„å‡ºç°

å¾®ä¿¡è·³ä¸€è·³è¿™ä¸ªå¾®ä¿¡å®˜æ–¹æ¨å‡ºçš„ DAU ç¬¬ä¸€,1 ç‚¹å‡ äº¿çš„å°æ¸¸æˆç›¸ä¿¡å¤§å®¶éƒ½ç©è¿‡ï¼Œå¾®ä¿¡ç”¨è·³ä¸€è·³æ¸¸æˆå†…æ¤å…¥å¹¿å‘Šçš„æ–¹å¼å˜ç°ä¹Ÿæ˜¯ä¸€ä¸ªåˆ›æ–°ã€‚
ä½†æ˜¯ç›¸ä¿¡å¤§å®¶çœ‹åˆ°è¿‡å¾ˆå¤šåˆ·å­ï¼Œæœ‰ç‰©ç†ç¡¬ä»¶è¾…åŠ©ä½œå¼Šçš„ã€‚å¦‚æœºæ¢°æ‰‹+å°ºå­é‡è·ç¦»ï¼Œæˆ–è€…ç‰›é€¼ç‚¹çš„ï¼Œæœºæ¢°æ‰‹+å›¾åƒè¯†åˆ«ç®—æ³•åŠ ä¸Šã€‚

![è·³ä¸€è·³æœºæ¢°æ‰‹ä½œå¼Š](../images/tiaoyitiao-jixieshou.jpg)

ä¹Ÿæœ‰åŸºäºè½¯ä»¶å±‚é¢çš„ï¼Œæ‰¾åˆ°æ¼æ´ç›´æ¥æ¥å£åˆ·åˆ†æ•°ã€‚

åˆ·åˆ†è½¯ä»¶å¯ä»¥çœ‹[è¿™é‡Œ](https://github.com/wangshub/wechat_jump_game)ï¼Œå½“ç„¶ç°åœ¨åº”è¯¥è¢«ç¦äº†ã€‚

å¼ å°é¾™åœ¨ä»Šå¹´çš„å¾®ä¿¡å°æ¸¸æˆä¸Šè¯´è¿‡è¿™ä¹ˆä¸€æ®µè¯:

> è·³ä¸€è·³é­é‡å¾ˆå¤šå¤–æŒ‚ï¼Œå¼•å‘çš„ä¸¤ç‚¹æ€è€ƒ
>
> - ç¬¬ä¸€æ–¹é¢ï¼Œå½“æˆ‘çœ‹åˆ°æˆ‘çš„æœ‹å‹ç”¨å¤–æŒ‚æ‰“äº†ä¸€ä¸ªå¾ˆé«˜çš„åˆ†çš„æ—¶å€™ï¼Œæˆ‘çš„æ„è¯†é‡Œå¯¹ä»–çš„ä¿¡ä»»åº¦å¯èƒ½ä¼šé™ä½ä¸€ç‚¹ç‚¹ï¼Œæœ‹å‹ä¹‹é—´çš„ä¿¡ä»»ä¼šå‡ºç°é—®é¢˜ï¼›
> - å¦å¤–ä¸€ä¸ªè§’åº¦æ¥è¯´ï¼Œåƒåœ¨è·³ä¸€è·³è¿™æ ·ä¸€ä¸ªå°çš„æ¸¸æˆé‡Œé¢ï¼Œå¦‚æœä¸€ä¸ªç”¨æˆ·çœ‹åˆ°é‡Œé¢æœ‰ä¸€å †å¤–æŒ‚å¾—äº†å¾ˆé«˜çš„åˆ†ï¼Œå¯¹å…¶ä»–ä¸€äº›æ¯å¤©åœ¨ç»ƒä¹ ï¼Œè¯•å›¾æŠŠè‡ªå·±çš„æ°´å¹³æé«˜ï¼Œè€Œæ‰“ä¸€ä¸ªé«˜åˆ†çš„äººå°±å¾ˆä¸å…¬å¹³ï¼Œä»–å¯èƒ½å°±æ²¡æœ‰åŠ¨åŠ›ç»§ç»­å»ç»ƒä¹ ï¼Œç»§ç»­è¶…è¶Šè‡ªå·±ä¸ªäººçš„æœ€é«˜åˆ†æ•°ã€‚æ‰€ä»¥è¿™æ ·ä¸€ä¸ªè¡Œä¸ºï¼Œå¤–æŒ‚è¡Œä¸ºå…¶å®ä¼šç ´åæ•´ä¸ªç³»ç»Ÿçš„è§„åˆ™ï¼Œå¹¶ä¸”è®©è§„åˆ™ç«‹å³å˜å¾—å¤±æ•ˆã€‚

ç”¨æˆ·ç©æ¸¸æˆæ˜¯æœ‰æ”€æ¯”ï¼Œè™šè£å¿ƒçš„å¿ƒæ€åœ¨é‡Œé¢çš„ï¼Œä¸ç„¶æ¸¸æˆå…¬å¸ä¹Ÿä¸ä¼šèµšé’±ï¼Œæ¸¸æˆè¡Œä¸šä¹Ÿä¸ä¼šæˆä¸ºæš´åˆ©è¡Œä¸šäº†ã€‚æ¸¸æˆç­–åˆ’ä¼šç ”ç©¶ç”¨æˆ·å¿ƒç†å­¦ï¼Œè®©ä½ æ²‰è¿·ï¼ŒæŠ•é’±ï¼ŒèŠ±è´¹æ—¶é—´è·Ÿç²¾åŠ›åœ¨æ¸¸æˆä¸Šï¼Œå…¶å®å¤§å®¶éƒ½ä»èµŒåœºé‡Œé¢å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ï¼Œå¹¶ç”¨åœ¨å„ä¸ªé¢†åŸŸã€‚æŠ–éŸ³çœ‹ä¸åˆ°æ—¶é—´ï¼Œä½ å¯ä»¥æ— é™åˆ·ä¸‹å»ï¼Œç±»ä¼¼çš„åº”ç”¨è®¾è®¡è¿˜æœ‰ä¸å°‘ã€‚å¤§å®¶å¯ä»¥å¤šçœ‹çœ‹è§‚å¯Ÿè§‚å¯Ÿã€‚

è¨€å½’æ­£ä¼ ï¼Œæ¥è¯´è¯´æˆ‘ä»¬è¿™æ–¹é¢ï¼Œæˆ‘ä»¬çš„æ¸¸æˆæ˜¯ä¸€æ¬¾æ¨å†°çƒçš„åº”ç”¨ï¼ŒåŸºäº Laya+matterJSï¼ŒmatterJS å¯ä»¥ç‚¹[è¿™é‡Œ](http://brm.io/matter-js/)çœ‹ä¸‹ï¼Œé‚£ä¸ªæ—¶å€™ Laya è¿˜æ²¡æœ‰å†…ç½®ç‰©ç†å¼•æ“ï¼Œå½“ç„¶ç°åœ¨å·²ç» 2.0 äº†ï¼Œå†…ç½®ç‰©ç†å¼•æ“ï¼Œæ‰€ä»¥å†°çƒè¿™ä¸ªæ¸¸æˆå¯èƒ½æ˜¯å›½å†…æœ€æ—©åŸºäºLayaå°è¯•å¼•å…¥ç‰©ç†å¼•æ“å®ç°ç‰©ç†æ•ˆæœç›¸å…³çš„å¾®ä¿¡å°æ¸¸æˆäº†ã€‚

![æ¬¢ä¹æ¨å†°çƒ](../images/curling.png)

æ¸¸æˆè§„åˆ™å¾ˆç®€å•ï¼Œç”¨æˆ·é€šè¿‡å°†å†°çƒæ¨å‡ºåˆ°å›ºå®šå¾—åˆ†åŒºåŸŸè€Œè·å¾—åˆ†æ•°ï¼Œå››ä¸ªå…³å¡ä¸‹æ¥ç´¯è®¡ç”¨æˆ·çš„æ€»å¾—åˆ†ï¼ŒæŒ‰ç…§æ¸ é“ï¼ˆæ‰‹Qï¼Œå¾®ä¿¡ï¼‰åˆ†åˆ«åšæ’è¡Œæ¦œï¼Œæ’åå‰é¢çš„ç”¨æˆ·è·å¾—é‡‘é’±å¥–åŠ±ã€‚

# ç‰©ç†æ¨¡å‹çš„æ”¾ç½®

æˆ‘ä»¬çŸ¥é“ï¼Œæ¸¸æˆå°±æ˜¯ä¸€å †è´´å›¾åœ¨å±å¹•çš„ç‰©ç†å˜æ¢ï¼Œæœ€åå‘ˆç°å‡ºæ¥å°±æ˜¯ç±»ä¼¼æ¸¸æˆçš„æ•ˆæœã€‚ä½†æ˜¯å¦‚æœæ¸¸æˆé‡Œé¢æœ‰ç‰©ç†æ¨¡å‹çš„è¯ï¼Œé‚£ä¹ˆé™¤äº†è´´å›¾è¿™ä¸€å±‚ä¹‹å¤–ï¼Œä¸ä¹‹ç›¸å¯¹çš„è¿˜æœ‰ç‰©ç†æ¨¡å‹è¿™ä¸€å±‚ã€‚å°±å¦‚åŒåˆ«äººçœ‹åˆ°ä½ åœ¨èµ°è·¯ï¼Œé™¤äº†ä½ èº«ä¸Šä¼ çš„è¡£æœåœ¨åŠ¨ä¹‹å¤–ï¼Œå…¶å®å¾ˆé‡è¦çš„æ˜¯ï¼Œä½ è¿™ä¸ªäººçš„ç‰©ç†æ¨¡å‹åœ¨è¿åŠ¨ï¼Œå†æŠŠè¡£æœè´´ä¸Šæ¥ï¼Œå°±æ˜¯ä½ æ•´ä¸ªäººåœ¨è¿åŠ¨ï¼Œè€Œä¸”æ˜¯è¦ç¬¦åˆç‰©ç†è§„å¾‹çš„è¿åŠ¨ã€‚èµ°è·¯ï¼Œæ˜¯å·¦å³è„šäº¤æ›¿å‘å‰èµ°ã€‚è·‘æ­¥ï¼Œè„šæ­¥äº¤æ›¿çš„é¢‘ç‡æ›´å¿«ï¼Œè¿åŠ¨å§¿åŠ¿ä¹Ÿä¸ä¸€æ ·ã€‚

æˆ‘ä»¬åšä¸€ä¸ªæœ‰ç‰©ç†æ¨¡å‹çš„æ¸¸æˆï¼Œä¸€å¼€å§‹å°±ä¼šè¿›å…¥ä¸€ä¸ªé€‰æ‹©ï¼Œç‰©ç†æ¨¡å‹ï¼ˆæˆ˜æ–—é€»è¾‘ã€ä¸»è¦é€»è¾‘ï¼‰æ˜¯æ”¾åœ¨å‰ç«¯ï¼ˆå®¢æˆ·ç«¯ï¼‰è¿˜æ˜¯åå°ï¼ˆæœåŠ¡å™¨ï¼‰ã€‚

## ç‹è€…å†œè¯&å¸§åŒæ­¥

è¿™å°±å†³å®šäº†ä¸åŒçš„æŠ€æœ¯æ¶æ„ï¼Œæ¯”å¦‚ç‹è€…è£è€€ï¼Œ10 ä¸ªæ¸¸æˆç©å®¶è”å…¥äº†ä¸€å°æ¸¸æˆæœåŠ¡å™¨ã€‚å®¢æˆ·ç«¯ä¹‹é—´æ— é€šä¿¡ï¼Œ10 ä¸ªå®¢æˆ·ç«¯éƒ½è”å…¥æœåŠ¡å™¨ï¼Œæ•°æ®é€šè¿‡æœåŠ¡å™¨è½¬å‘ç»™å…¶ä»–ç”¨æˆ·ã€‚ç„¶åå®¢æˆ·ç«¯æ¯ä¸€å¸§ï¼ˆ16.67msï¼‰å»æ¸²æŸ“ä¸€æ¬¡ç”»é¢ã€‚ä½†æ˜¯å®¢æˆ·ç«¯å¯¹ç”¨æˆ·çš„è¾“å…¥ä¸æ˜¯ 16.67ms åŒæ­¥ä¸€æ¬¡ï¼Œè€Œæ˜¯æ ¹æ®ç”¨æˆ·æœ‰æ— æ“ä½œï¼Œæ“ä½œçš„é¢‘ç‡ï¼Œç”¨æˆ·æ‰€åœ¨ç½‘ç»œçš„çŠ¶æ€ï¼ˆwifi æƒ…å†µä¼šæ¯” 4G,3G æƒ…å†µå‘åŒ…æ›´å¤šï¼Œä¹Ÿå°±æ˜¯ä¸Šä¼ çš„æ•°æ®ä¼šæ›´å¤šï¼Œç”¨æˆ·å°±å›è§‰å¾—æ“ä½œè¶Šæµç•…ï¼‰å»å‘é€è¯·æ±‚ã€‚

> åŠ¨ç”»çš„åŸç†å°±æ˜¯æ®‹ç•™åœ¨äººçœ¼çš„æ—¶é—´ï¼Œä¸€èˆ¬æˆ‘ä»¬ä»¥ 60fps ä¸ºæµç•…æ¥ä»½ï¼Œé‚£ä¹ˆå°±æ˜¯ 1s/60fps = 16.67msã€‚ä¹Ÿå°±æ˜¯è¯´ä½ è¦ 16.667ms å»æ¸²æŸ“ä¸€ä¸ªä¸åŒçš„ä¸œè¥¿ï¼ˆæ¯”å¦‚äººèµ°è·¯ï¼‰ï¼Œäººçœ¼å°±ä¼šè§‰å¾—è¿™æ˜¯åœ¨è¿åŠ¨ï¼Œè€Œä¸å¡é¡¿

æœåŠ¡å™¨æ”¶åˆ° 10 ä¸ªç”¨æˆ·çš„æ“ä½œæŒ‡ä»¤ï¼Œå»è½¬å‘æ•°æ®ï¼Œæ¯”å¦‚å“ªä¸ªç”¨æˆ·å‡»æ€äº†ä¸»å®°ï¼Œè·å¾—äº†å¤šå°‘é’±ï¼Œåæ ‡ XY å€¼ï¼ŒæŠ€èƒ½å†·å´ç­‰ç­‰ã€‚ç„¶åå†æŠŠç”¨æˆ·éœ€è¦çš„æ•°æ®æ¨é€ç»™ç”¨æˆ·ï¼ˆä¸å¯èƒ½è½¬å‘å…¨å±€æ‰€æœ‰æ•°æ®ï¼Œå¤ªå¤§äº†ä¹Ÿä¸å®‰å…¨ï¼Œè€Œæ˜¯ä½ å®¢æˆ·ç«¯åœ¨è¿™ä¸ªä½ç½®è¿™ä¸ªæ—¶é—´éœ€è¦çš„æ•°æ®ï¼Œè‡³äºè¿™ä¸ªé¢„åˆ¤ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±æƒ³æƒ³ï¼‰ã€‚

ç„¶åå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„æ¨é€ä¹‹åï¼Œåšä¸€äº›å¹³æ»‘è¿‡æ¸¡ï¼Œæ’å€¼å¤„ç†ï¼Œè®©å®¢æˆ·ç«¯çš„å‘ˆç°è‡ªç„¶ä¸€äº›ä¸ä¼šå‡ºç°ç¬ç§»ä¹‹ç±»çš„æƒ…å†µï¼Œå¹³æ»‘è¿‡åº¦åˆ°æœåŠ¡å™¨åˆ¤å®šçš„æ•°æ®çŠ¶æ€å»ã€‚

å¤§å®¶å‘ç°æ²¡æœ‰ï¼Œè¿™ç§æƒ…å†µï¼Œæˆ˜æ–—é€»è¾‘å’Œç‰©ç†æ¨¡å‹ï¼ˆå‡»æ‰“å°å…µï¼Œåœ°å›¾ä»»åŠ¡ä¹‹é—´çš„ç¢°æ’ï¼‰æ˜¯æ”¾åœ¨å‰å°ï¼Œåç«¯åªè´Ÿè´£è½¬å‘æ•°æ®ã€‚

æ‰€ä»¥å¤§å®¶å¯ä»¥äº†è§£ï¼Œä¸ºä»€ä¹ˆç»åœ°æ±‚ç”Ÿåƒé¸¡æˆ˜åœºé‡Œé¢ï¼Œæœ‰æ—¶å€™ä½ æ‰“ä¸¤æªè¿‡å»ä¸æ‰“ï¼Œå¯¹æ–¹æ²¡æœ‰é©¬ä¸Šæ­»äº¡ï¼Œè€Œæ˜¯å¡äº†ä¸€ä¸‹æ‰æ­»ã€‚è¿™ä¸ªæƒ…å†µä¸ºä»€ä¹ˆä¼šå‡ºç°ï¼Ÿ

å…¶å®è¿™ä¸ªè¿‡ç¨‹æ˜¯æœ‰ç½‘ç»œå»¶è¿Ÿçš„ï¼Œä½ å‘åŒ…å‡ºå»ï¼Œå¯èƒ½ä¸ä¼šé©¬ä¸Šæ”¶åˆ°å›åº”ï¼Œè€Œæ˜¯ç»è¿‡æœåŠ¡å™¨è½¬å‘ï¼Œè°å…ˆæ‰“è°ï¼Œæ‰“äº†å¤šå°‘è¡€ï¼Œæ­»äº†æ²¡æœ‰ï¼Œæœ€åå°†åˆ¤å®šæ¡ä»¶å‘é€åˆ°ä½ å’Œå¯¹æ–¹çš„æœºå™¨ä¸Šã€‚

ä»¥ä¸Šéƒ½æ˜¯å±äºå¸§åŒæ­¥å†…å®¹ã€‚ä¹Ÿå¯ä»¥çœ‹çœ‹[è¿™ç¯‡](https://zhuanlan.zhihu.com/p/36884005)äº†è§£ä¸‹å¸§åŒæ­¥è·ŸçŠ¶æ€åŒæ­¥çš„åŒºåˆ«ã€‚

## å•æœºæ¸¸æˆ

å•æœºæ¸¸æˆå°±æ¯”è¾ƒæœ‰è¶£äº†ï¼Œæˆ‘ä»¬ç©è¿‡å¾ˆå¤šå•æœºæ¸¸æˆï¼Œæ¯”å¦‚ä»™å‰‘ä¹‹ç±»çš„è§’è‰²æ‰®æ¼”ã€‚å¯ä»¥å¼€ä½œå¼Šå™¨å„ç§ modï¼Œæ¯”å¦‚ CS å¯ä»¥æœ¬åœ°ç©ã€‚ä½†æ˜¯ CS ä¹Ÿå¯ä»¥ä¸Šç½‘å¯¹æˆ˜ã€‚å…¶å®å°æ¸¸æˆå°±æ˜¯å•æœºæ¸¸æˆï¼Œå¤§å®¶çŸ¥é“å—ï¼Ÿ

å•æœºæ¸¸æˆå› ä¸ºå¼€å‘æˆæœ¬ä½ï¼Œå¼€å‘æ•ˆç‡å¿«ï¼Œä¹Ÿæ˜¯æœ‰å¾ˆå¤šå°æ¸¸æˆæ˜¯è¿™ä¸ªç±»å‹çš„ã€‚ä½†æ˜¯æˆ‘ä»¬æ— æ³•é¿å…çš„å°±æ˜¯ï¼Œå•æœºæ¸¸æˆå¦‚æœåšæ’è¡Œæ¦œï¼Œä¸å¯é¿å…çš„ä¼šé‡åˆ°åˆ·å­ã€‚

ç‰©ç†æ¨¡å‹çš„ä½œå¼Šé˜²èŒƒä¼šå¾ˆéš¾åšï¼Œæ¯”å¦‚è·³ä¸€è·³æ˜¯ç”¨äº†æˆé•¿æ¨¡å‹ï¼Œä¸€ä¸ªä½åˆ†ç”¨æˆ·ä¸å¤ªå¯èƒ½ä¸€ä¸‹å­æ‰“åˆ°é«˜åˆ†è¿™ç§æ¨¡å‹ã€‚è¿™ç§æŠ•å…¥å¤ªé«˜äº†ï¼Œè€Œä¸”éœ€è¦å¤§é‡æ•°æ®å»å­¦ä¹ è¿™ä¸ªæˆé•¿çš„å¹³æ»‘æ€§ã€‚ä¸€èˆ¬å°æ¸¸æˆä¹Ÿæ²¡æœ‰è¿™ä¹ˆå¤§æ•°æ®é‡ã€‚

**ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨ä¸ŠæŠ¥åˆ†æ•°éƒ¨åˆ†åšå®‰å…¨ï¼Œä¹Ÿæ˜¯å¿…é¡»åšçš„ã€‚**å¯ä»¥å‡å°‘åˆ·æ¥å£çš„å¯èƒ½æ€§ã€‚

# å•æœºæ¸¸æˆå®‰å…¨æ€ä¹ˆåš

å…¶å®å½’ç»“èµ·æ¥å°±æ˜¯**æ¸¸æˆæœ€åä¸ŠæŠ¥åˆ†æ•°è¿‡ç¨‹ï¼Œå¦‚ä½•è®©ç”¨æˆ·çœ‹ä¸åˆ°æ˜æ–‡çš„ä¼ è¾“ã€‚å‡å°‘ç”¨æˆ·åˆ·æ¥å£çš„å¯èƒ½ã€‚**

## RSA ç®—æ³•åŠ å¯†

æ•°å­—ç­¾åå¹¶ä¸æ˜¯åŠ å¯†ã€‚ä»–åªæ˜¯å°†ä¼ é€’çš„å‚æ•°è¿›è¡Œç­¾åã€‚æœåŠ¡å™¨ç«¯å¯ä»¥éªŒç­¾ã€‚ä¸»è¦ä½œç”¨æœ‰ 2 ä¸ªï¼š

> 1.ä¿è¯æ•°æ®ä¸ä¼šè¢«ç¯¡æ”¹ 2.ä¿è¯è¯·æ±‚çš„ç¡®æ˜¯ç§˜é’¥æŒæœ‰è€…å‘é€çš„

RSA ç®—æ³•å¯ä»¥ç”Ÿæˆå…¬é’¥å’Œç§é’¥ï¼Œæˆ‘ä»¬åœ¨ node æœåŠ¡å™¨æ ¹æ®æˆ‘ä»¬é…ç½®çš„ randomKey å’Œç”¨æˆ· uid ç”Ÿæˆå…¬é’¥å’Œç§é’¥ã€‚å…·ä½“ç”Ÿæˆè¿‡ç¨‹ä¸é€éœ²äº†ï¼Œå°±æ˜¯ç”Ÿæˆä¸€ä¸ª RSA çš„å…¬é’¥å’Œç§˜é’¥ã€‚

RSA çš„åŸºæœ¬åŸç†å¯ä»¥çœ‹ä¸‹ç„œå“¥çš„[RSA ç®—æ³•åŸºç¡€è¯¦è§£](https://www.cnblogs.com/hykun/p/RSA.html)

åå° node ç«¯å¯ä»¥çœ‹è¿™ä¸ªåº“ï¼Œ[node-rsa](https://www.npmjs.com/package/node-rsa)
å‰ç«¯å¯ä»¥çœ‹è¿™ä¸ªåº“ï¼Œ[jsencrypt](https://www.npmjs.com/package/jsencrypt)

åˆ†ä¸¤ä¸ªåº“çš„åŸå› æ˜¯å› ä¸ºå‰ç«¯ç”¨ node-rsa çš„è¯å¤ªé‡äº†ï¼Œè€Œç”¨åœ¨ node çš„è¯æ–‡ä»¶å¤§å°å¯ä»¥å¿½ç•¥ã€‚éƒ½æ˜¯ä»æœ¬åœ°ç£ç›˜è¯»çš„ã€‚
è€Œ jsencrypt åˆ™ä¸æ”¯æŒå…¬ç§˜é’¥éƒ½ç”¨ pkcs8 çš„ï¼Œjsencrypt é»˜è®¤çš„ç§é’¥æ˜¯ pcks1 çš„ï¼Œå…¬é’¥åˆ™æ˜¯ pcks8 çš„ï¼Œè¿™ä¸ªå¯ä»¥ä»[ç½‘ç«™çš„ demo](http://travistidwell.com/jsencrypt/demo/index.html)çœ‹åˆ°ã€‚

> è‚‰çœ¼å¯ä»¥åŒºåˆ†çš„æ–¹æ³•å°±æ˜¯ï¼š
> å¼€å¤´å£°æ˜æœ‰æ²¡æœ‰ RSA çš„å­—æ ·ï¼Œæœ‰çš„è¯æ˜¯ pkcs1 çš„ï¼Œæ²¡æœ‰åˆ™æ˜¯ pkcs8 çš„
>
> - pkcs1 çš„å…¬é’¥ä»¥`-----BEGIN RSA PUBLIC KEY-----`å¼€å¤´ï¼Œç§é’¥ä»¥`-----BEGIN RSA PRIVATE KEY-----`å¼€å¤´
> - pkcs8 çš„å…¬é’¥ä»¥`-----BEGIN PUBLIC KEY-----`å¼€å¤´ï¼Œç§é’¥ä»¥`-----BEGIN PRIVATE KEY-----`å¼€å¤´

ç»“å°¾ç±»ä¼¼ï¼Œéƒ½æ˜¯çœ‹ RSA å­—æ ·æœ‰æ— åŒºåˆ† pkcs1 å’Œ pkcs8ã€‚pkcs1 å’Œ pkcs8 çš„åŒºåˆ«å¯ä»¥çœ‹ä¸‹[ç®€å•äº†è§£ PKCS è§„èŒƒ](https://razeen.me/post/introduce-pkcs.html)

å…·ä½“ä»£ç å¦‚ä¸‹

```js
const len = 512 //å»ºè®®é…ç½®æ–‡ä»¶è¯»å–ï¼Œå¯ä»¥åŠ¨æ€æ§åˆ¶

// **** 1.nodeç”Ÿæˆä¸€å¯¹å¯†é’¥ï¼ŒæŠŠå…¬é’¥ä¼ é€’ç»™å‰ç«¯
const key = new NodeRSA({ b: len })
// JSEncrypt çš„å…¬é’¥æ˜¯pkcs8ï¼Œç§é’¥æ˜¯pkcs1
const pubKey = key.exportKey('pkcs8-public-pem')
const priKey = key.exportKey('pkcs1-private-pem')

console.log(pubKey)
console.log(priKey)

// **** 2.å‰ç«¯æ‹¿åˆ°å…¬é’¥åŠ å¯†æ•°æ®
const publicKey = pubKey // rsaç®—æ³•æ¯æ¬¡å¾—å‡ºçš„å…¬é’¥ä¹Ÿä¸ä¸€æ ·
const gameInfo = { level: 2, ballInfo: {}, score: 66 }
const jencrypt = new JSEncrypt({ default_key_size: len }) // å®ä¾‹åŒ–åŠ å¯†å¯¹è±¡
jencrypt.setPublicKey(publicKey)
const encrypted = jencrypt.encrypt(JSON.stringify(gameInfo)) // åŠ å¯†æ˜æ–‡
console.log(encrypted) // rsaæ¯æ¬¡åŠ å¯†ç®—æ³•å¾—å‡ºçš„å¯†æ–‡ä¹Ÿä¸ä¸€æ ·

// **** 3.nodeæ‹¿ç§é’¥è§£å¯†å‰ç«¯ä¼ æ¥çš„å¯†æ–‡
const newKey = new NodeRSA(priKey)
// è¿™å¥å¿…é¡»å†™ï¼Œå¦åˆ™æŒ‰ç…§pkcs8å¤„ç†ï¼Œè§£å¯†ä¼šå¤±è´¥
newKey.setOptions({ encryptionScheme: 'pkcs1' })
const result = newKey.decrypt(encrypted, 'utf8')
console.log(result) // {"level":2,"ballInfo":{},"score":66} ä¸æˆ‘ä»¬å®šä¹‰çš„gameInfoä¸€æ ·
```

çŸ­å°ç²¾æ‚å…¶å®å¾ˆç®€å•å°±å‡ è¡Œä»£ç ã€‚`newKey.setOptions({encryptionScheme: 'pkcs1'})`è¦æ³¨æ„ä¸‹ï¼Œå¿…é¡»å†™ï¼Œå¦åˆ™æŒ‰ç…§ pkcs8 å¤„ç†ï¼Œè§£å¯†ä¼šå¤±è´¥ã€‚

## å…¶ä»–ç­–ç•¥æ–¹æ³•

æ¯”å¦‚ç©å®¶æ€»å…±æœ‰ 10 ä¸ªçƒï¼Œé‚£ä¹ˆæˆ‘å¯ä»¥æŒ‰ç…§ 10 ä¸ªçƒ\*10 åˆ†=100 åˆ†æ¥è®¾å®šæ€»åˆ†ä¸Šé™ï¼Œå¦‚æœæœ‰äººç”¨è¶…å‡ºè¿™ä¸ªæ•°å€¼æ¥ä¸ŠæŠ¥åˆ†æ•°ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºæ˜¯ä½œå¼Š

è¿˜æœ‰çš„ï¼Œæ¯ä¸€å…³éƒ½ä¸ŠæŠ¥åˆ†æ•°åˆ°åå°ï¼Œåå°è¿›è¡Œç´¯è®¡ã€‚å¹¶ä¸æ¯æ¬¡æŠ•å®Œçš„çƒåˆ†å¸ƒæƒ…å†µè¿›è¡Œè®¡ç®—ã€‚æ ¡éªŒåˆ†æ•°çš„æ­£ç¡®æ€§ã€‚

è¿™äº›éƒ½æ˜¯åŸºäºæ¸¸æˆé€»è¾‘çš„æµ‹ç®—ï¼Œä¸åŒæ¸¸æˆæ–¹æ³•ä¸åŒï¼Œä½†æ˜¯å¯ä»¥å€Ÿé‰´ã€‚

## protobuf

web æ–¹é¢é€šå¸¸æ˜¯æ˜æ–‡ä¼ é€’çš„ï¼Œä½†æ˜¯åœ¨å®¢æˆ·ç«¯æ¥è¯´ï¼Œå…¨éƒ¨æ•°æ®åŠ å¯†ä¼ è¾“ä¼šå¥½å¾—å¤šï¼Œä¸€æ˜¯å®‰å…¨æ€§å¤§å¤§æé«˜ï¼ŒäºŒæ˜¯ä¼ è¾“æ•ˆç‡ä¹Ÿä¼šå¾ˆå¥½ã€‚

### ä»€ä¹ˆæ˜¯ Google Protocol Bufferï¼Ÿ

Google Protocol Buffer( ç®€ç§° Protobuf) æ˜¯ Google å…¬å¸å†…éƒ¨çš„æ··åˆè¯­è¨€æ•°æ®æ ‡å‡†ï¼Œç›®å‰å·²ç»æ­£åœ¨ä½¿ç”¨çš„æœ‰è¶…è¿‡ 48,162 ç§æŠ¥æ–‡æ ¼å¼å®šä¹‰å’Œè¶…è¿‡ 12,183 ä¸ª .proto æ–‡ä»¶ã€‚ä»–ä»¬ç”¨äº RPC ç³»ç»Ÿå’ŒæŒç»­æ•°æ®å­˜å‚¨ç³»ç»Ÿã€‚

Protocol Buffers æ˜¯ä¸€ç§è½»ä¾¿é«˜æ•ˆçš„ç»“æ„åŒ–æ•°æ®å­˜å‚¨æ ¼å¼ï¼Œå¯ä»¥ç”¨äºç»“æ„åŒ–æ•°æ®ä¸²è¡ŒåŒ–ï¼Œæˆ–è€…è¯´åºåˆ—åŒ–ã€‚å®ƒå¾ˆé€‚åˆåšæ•°æ®å­˜å‚¨æˆ– RPC æ•°æ®äº¤æ¢æ ¼å¼ã€‚å¯ç”¨äºé€šè®¯åè®®ã€æ•°æ®å­˜å‚¨ç­‰é¢†åŸŸçš„è¯­è¨€æ— å…³ã€å¹³å°æ— å…³ã€å¯æ‰©å±•çš„åºåˆ—åŒ–ç»“æ„æ•°æ®æ ¼å¼ã€‚ç›®å‰æä¾›äº† C++ã€Javaã€Python ä¸‰ç§è¯­è¨€çš„ APIã€‚

å¯ä»¥ä¸¾ä¸ªæ —å­ï¼š [ç‚¹å‡»è¿™é‡Œ](http://game.fire2333.com/home/ac?action=/home/game/a/1663/g/200013)
æ‰“å¼€æ§åˆ¶å°,websocket æœåŠ¡ï¼Œå¯ä»¥çœ‹åˆ°`Binary Frame (Opcode 2, mask)`
ä¼ é€’çš„éƒ½æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œè€Œä¸”æ˜¯ ws è¿æ¥ï¼Œå®‰å…¨æ€§ç°å¸¸é«˜çš„ã€‚

![chromeå¼€å‘å·¥å…·çœ‹protobuf](../images/protobufExample.jpg)

å¯ä»¥å‘ç°éƒ½æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œå¦‚æœä½ ä¸çŸ¥é“å¦‚ä½•è§£ç ï¼Œå®Œå…¨ä¸çŸ¥é“æ˜¯ä»€ä¹ˆæ„æ€çš„ã€‚æ‰€ä»¥å…¶å®ç”¨ä¸Šè¿™ä¸œè¥¿ï¼Œå°±å¯ä»¥ä¸ç”¨ä¸Šé¢è¯´çš„ RSA åŠ å¯†è§£å¯†äº†ã€‚

ä¸¾ä¸ª ğŸŒ°ï¼Œé¦–å…ˆæˆ‘ä»¬è¦å®šä¹‰ä¸€ä¸ªæ ¼å¼ï¼Œå½“ç„¶ä¸€èˆ¬æ˜¯ proto åç¼€ç±»å‹çš„ï¼Œå¦‚æœä½ æƒ³è¦ JSON çš„ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯ä¸ªäººæ„Ÿè§‰æ²¡å¿…è¦ï¼Œå› ä¸º JSON ç±»å‹çš„ä¹Ÿæ˜¯ proto ç±»å‹çš„è½¬åŒ–è¿‡å»çš„ï¼Œæ‰€ä»¥ç›´æ¥ç‚¹ï¼Œå°±ç”¨ proto ç±»å‹çš„èµ°èµ·ã€‚

```js
// awesome.proto
package awesomepackage;
syntax = "proto3";

message AwesomeMessage {
    string awesome_field = 1; // becomes awesomeField
}
```

```js
// node
protobuf.load('awesome.proto').then(root => {
  if (err) throw err

  // è¿™é‡Œæ‹¿åˆ°å®šä¹‰çš„ç±»å‹äº†
  var AwesomeMessage = root.lookupType('awesomepackage.AwesomeMessage')

  // éœ€è¦ä¼ é€’çš„æ•°æ®
  var payload = { awesomeField: 'AwesomeString' }

  // æ ¡éªŒæ•°æ®æ ¼å¼
  var errMsg = AwesomeMessage.verify(payload)
  if (errMsg) throw Error(errMsg)

  // åˆ›å»ºä¼ é€’çš„æ¶ˆæ¯
  var message = AwesomeMessage.create(payload) // or use .fromObject if conversion is necessary

  // ä»¥ä¸‹å±äºè§£ç éƒ¨åˆ†

  // ç¼–ç äºŒè¿›åˆ¶
  var buffer = AwesomeMessage.encode(message).finish()

  // è§£ç äºŒè¿›åˆ¶æˆæ¶ˆæ¯
  var message = AwesomeMessage.decode(buffer)

  // è½¬åŒ–ä¸ºå¯¹è±¡
  var object = AwesomeMessage.toObject(message, {
    longs: String,
    enums: String,
    bytes: String
  })
  // æœ€åè§£ç å‡ºæ¥object  = { awesomeField: "AwesomeString" }
})
```
